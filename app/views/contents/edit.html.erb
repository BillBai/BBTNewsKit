<div class="page-header">
  <h3> Edit <%= @content.content_type %> <%= @content.id %></h3>
</div>

    <%= link_to 'Back', content_path(@content) %>
<div class="row">
  <div class="col-md-8">
    <div class="panel panel-default">
      <div class="panel-heading">
        Content meta data
        <%=raw status_label(@content, @content.status) %>
        <%=raw content_type_label(@content, @content.content_type) %>
      </div>
      <div class="panel-body">
        <%= render partial: 'form' , locals: {content_type: @content.content_type}%>
      </div>
    </div>
    <% case  @content.content_type %>
    <% when 'article' %>
        <strong>Article body</strong>
        <hr/>
        <div id="editor-container">
          <div class="editable">
            <%=raw @content.body_html %>
          </div>
        </div>
    <% when 'album' %>
        <h2>Add photo</h2>
        <%= render 'photos/form' %>

    <% when 'video' %>
    <% when 'special'%>
        <hr/>
        <%= link_to add_content_contents_path(@content, content_type: :article), {role: 'button', class: 'btn btn-primary'} do %>
            <span class='glyphicon glyphicon-file'></span> Add article
        <% end %>
        <%= link_to add_content_contents_path(@content, content_type: :album), {role: 'button', class: 'btn btn-primary'} do %>
            <span class='glyphicon glyphicon-picture'></span> Add album
        <% end %>
        <%= link_to add_content_contents_path(@content,content_type: :video), {role: 'button', class: 'btn btn-primary'} do %>
            <span class='glyphicon glyphicon-facetime-video'></span> Add video
        <% end %>
        <%= render partial: 'list', locals: {contents: @content.subcontents} %>
    <% end %>
  </div>


  <div class="col-md-4">
    <!-- Actions panel-->
      <div class="panel panel-primary">
      <div class="panel-heading">
        Actions
      </div>
      <div class="panel-body">
        <button type="button" class="btn btn-primary" id="save-content-button">Save draft</button>
        <!-- Single button -->
        <div class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            Other <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <li><%= link_to 'Delete', content_path(@content), method: :delete, data: { confirm: 'Are you sure?'}, role: 'button', class: 'btn btn-danger' %>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Actions panel END -->

    <!-- Author panel -->
    <div class="panel panel-default">
      <div class="panel-heading">Publisher</div>
      <div class="panel-body">
        <%= select_tag :content_publisher, options_from_collection_for_select(Publisher.where(active: true), :id, :name, selected: @content.publisher_id) , {class: 'selectpicker', id: 'content-publisher-picker'}%>
      </div>
    </div>
    <!--Author panel END-->

    <!-- Author panel -->
    <div class="panel panel-default">
      <div class="panel-heading">Author</div>
      <div class="panel-body">
        <%= select_tag :content_author, options_from_collection_for_select(Author.where(active: true), :id, :name, selected: @content.author_id) , {class: 'selectpicker', id: 'content-author-picker'}%>
      </div>
    </div>
    <!--Author panel END-->

    <!--Section panel -->
    <div class="panel panel-default">
      <div class="panel-heading">Section</div>
      <div class="panel-body">
        <%= select_tag :content_section, options_from_collection_for_select(Section.where(active: true), :id, :module, selected: @content.section_id) , {class: 'selectpicker', id: 'content-section-picker'}%>
      </div>
    </div>
    <!-- Section panel END-->
  </div>
</div>



<script>
    var editor = new MediumEditor('.editable', {
        buttons:['bold', 'italic', 'underline', 'anchor', 'header1', 'header2', 'quote', 'image']
    });

    $(function () {


      $('.editable').mediumInsert({
          editor: editor,
          addons: {
              images: {
                  imagesDeleteScript: '/article_body_image/delete',
                  imagesUploadScript: '/contents/<%= @content.id %>/article_body_images'
              }
          }
      });

        $('.selectpicker').selectpicker();
    });

   $("#save-content-button").click(function() {
       console.log('23333');
       // if there is no editor, that means the content_type is not Article.
       if($('#editor-container').length != 0) {
           var allContents = editor.serialize();
           var elContent = allContents["element-0"].value;
           $("#content_body_html").val(elContent);

       }
       $('#content_author_id').val($('#content-author-picker').val());
       $('#content_section_id').val($('#content-section-picker').val());
       $('#content_publisher_id').val($('#content-publisher-picker').val());
       $("#content-form").submit();
    });


</script>


